<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS 特訓班</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" defer>
    <link rel="stylesheet" href="style.css" defer>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" defer></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" defer></script>
    <script src="scripts/main.js" defer></script>
    <script src="scripts/day48.js" defer></script>
</head>
<body>
    <div class="container mt-5">
        <!-- menu -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <a href="./" class="navbar-brand">JS特訓班</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="day44-46.html">Day44-46</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="day47.html">Day47</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="day48.html">Day48</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="container mt-3 mb-5">
        <!-- #48 -->
        <h2 class="display-2 mb-4">#48 SignUp / SignIn</h2>
        <div id="sign" class="form-sign">
            <div class="form">
                <label for="email" class="sr-only">Email address</label>
                <input type="email" class="form-control mb-2 email" placeholder="Email">

                <label for="password" class="sr-only">Password</label>
                <input type="password" class="form-control password" placeholder="Password">

                <div class="btnBox">
                    <button class="btn btn-primary my-3" id="signUpBtn">註冊</button>
                    <button class="btn btn-primary my-3" id="signInBtn">登入</button>
                </div>

                <div class="alert"></div>
            </div>
        </div>
        <pre class="pre-scrollable">
const signUpBtn = getElemt('#signUpBtn')
const signInBtn = getElemt('#signInBtn')
const mail = getElemt('.email')
const psw = getElemt('.password')
const msg = getElemt('.alert')
const ints = document.querySelectorAll('input')
const signupURL = 'https://hexschool-tutorial.herokuapp.com/api/signup'
const signinURL = 'https://hexschool-tutorial.herokuapp.com/api/signin'

function postAjax (url){
    axios.post(url, {
        email: mail.value,
        password: psw.value
    }).then(res => {
        if ( res.data.success ){
            if (url === signupURL) {
                msg.classList.add('alert-success')
            } else {
                msg.classList.add('alert-info')
            }
            msg.innerHTML = res.data.message
            ints.forEach( item => {
                item.value = ''
            })
        } else {
            msg.classList.add('alert-danger')
            msg.innerHTML = res.data.message
        }
    }).catch(err => {
        console.log(err.data)
    })
}

function checkFunc(e) {
    chkmail = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/
    chkpsw = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{0,20}$/
    isMail = mail.value.trim()
    isPsw = psw.value.trim()
    chk = true
    str = []
    
    // Email 驗證
    if( isMail == '' || !chkmail.exec(isMail) ) {
        str.push('Email 格式錯誤') 
        chk = false
        mail.classList.add('is-invalid')
    } else {
        chk = true
        mail.classList.remove('is-invalid')
    }
    
    // Password 驗證
    if ( isPsw == '' || !chkpsw.exec(isPsw) ) {
        str.push('須包含數字和英文字母')
        chk = false
        psw.classList.add('is-invalid')
    } else {
        chk = true
        psw.classList.remove('is-invalid')
    }
    
    // 切換狀態
    if (!chk) {
        msg.classList.add('alert-danger')
        msg.innerHTML = str.join('') // 加上br換行
    } else {
        msg.classList.remove('alert-danger')
        msg.innerHTML = ''
        msg.classList = 'alert'

        // 判斷按鈕
        if (e.target == signUpBtn) {
            postAjax(signupURL)
        } else if (e.target == signInBtn) {
            postAjax(signinURL)
        }
    }
}

signUpBtn.addEventListener('click', checkFunc)
signInBtn.addEventListener('click', checkFunc)</pre>

    </div>
</body>
</html>